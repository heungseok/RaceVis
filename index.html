<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="./style/style.css">


    <title>3secondz</title>
</head>

<body>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="js/underscore.js"></script>

    <nav class="navbar navbar-inverse navbar-fixed-top" style="position: absolute; left:0; top:0">
        <div class="container-fluid">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">3secondz</a>
            </div>


            <div id="navbar" class="navbar-collapse collapse">


                <ul class="nav navbar-nav navbar-right">
                    <li id="about" class="active"><a href="#">About</a></li>
                </ul>

            </div><!-- /.navbar-collapse -->
        </div>

    </nav>

    <div id="container">

        <div class="track_nav col-xs-3">

            <div class="sel_box">
                <label for="sel1">Select a Track:</label>
                <select class="form-control" id="sel1">
                    <option>KIC Short-1</option>
                    <option>KIC Short-2</option>
                    <option>KIC Short-3</option>
                    <option>KIC Short-4</option>
                </select>
            </div>

            <div class="sel_box">
            <label for="sel2">Select a Session:</label>
            <select class="form-control" id="sel2">
                <option>Session-1</option>
                <option>Session-2</option>
                <option>Session-3</option>
                <option>Session-4</option>

            </select>
            </div>

            <div class="sel_box">
            <label for="sel3">Select a Lap from the Selected Session:</label>
            <select class="form-control" id="sel3">
                <option>Lap-1</option>
                <option>Lap-2</option>
                <option>Lap-3</option>
                <option>Lap-4</option>
            </select>
            </div>



            <h4 style="margin-top:30px"> Select a Reference Lap:</h4>

            <div class="sel_box">
            <label for="sel4">Select a Session:</label>
            <select class="form-control" id="sel4">
                <option>Session-1</option>
                <option>Session-2</option>
                <option>Session-3</option>
                <option>Session-4</option>
            </select>
            </div>

            <div class="sel_box">
            <label for="sel5">Select a Lap from the Selected Session:</label>
            <select class="form-control" id="sel5">
                <option>Lap-1</option>
                <option>Lap-2</option>
                <option>Lap-3</option>
                <option>Lap-4</option>
            </select>
            </div>

            <div class="track_summary">

                <img style="height: 300px;" class="img_summary">

                <div class="table_summary">
                    <span>
                        summary statistic
                    </span>
                </div>

            </div>

        </div>


        <div id="canvas" class="col-xs-6">

        </div>


        <div class="right-nav col-x2-2">

            <div class="checkbox_wrapper col-xs-2">
                <div class="checkbox">
                    <label><input type="checkbox" value="GPS_Speed (kmh)" onclick=handleCBclick(this); checked="checked">GPS_Speed (kmh)</label>
                </div>
                <!--<div class="checkbox">-->
                    <!--<label><input type="checkbox" value="PosLat (deg)" onclick=handleCBclick(this);>PosLat (deg)</label>-->
                <!--</div>-->
                <!--<div class="checkbox">-->
                    <!--<label><input type="checkbox" value="PosLon (deg)" onclick=handleCBclick(this);>PosLon (deg)</label>-->
                <!--</div>-->
                <div class="checkbox">
                    <label><input type="checkbox" value="AccelForward (g)" onclick=handleCBclick(this);>AccelForward (g)</label>
                </div>

                <div class="checkbox">
                    <label><input type="checkbox" value="AccelLateral (g)" onclick=handleCBclick(this);>AccelLateral (g)</label>
                </div>

                <div class="checkbox">
                    <label><input type="checkbox" value="AccelCombi (g)" onclick=handleCBclick(this);>AccelCombi (g)</label>
                </div>

                <div class="checkbox">
                    <label><input type="checkbox" value="YawRate (deg/s)" onclick=handleCBclick(this);>YawRate (deg/s)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="GPS_Height (m)" onclick=handleCBclick(this);>GPS_Height (m)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="GPS_NumSat (NA)" onclick=handleCBclick(this);>GPS_NumSat (NA)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="RPM (NA)" onclick=handleCBclick(this); checked="checked">RPM (NA)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="Pedal_throttle (percent)" onclick=handleCBclick(this);>Pedal_throttle (percent)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="Pedal_brake (percent)" onclick=handleCBclick(this);>Pedal_brake (percent)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="Steer_angle (deg)"  onclick=handleCBclick(this);>Steer_angle (deg)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="Gear (NA)"  onclick=handleCBclick(this);>Gear (NA)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="CoolantT (c)"  onclick=handleCBclick(this);>CoolantT (c)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="OilT (c)"  onclick=handleCBclick(this); >OilT (c)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="Fuel (percent)"  onclick=handleCBclick(this); >Fuel (percent)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="IntakeBoost (bar)"  onclick=handleCBclick(this); >IntakeBoost (bar)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="IntakeTemp (c)"  onclick=handleCBclick(this); >IntakeTemp (c)</label>
                </div>
                <div class="checkbox">
                    <label><input type="checkbox" value="AFR (NA)"  onclick=handleCBclick(this); >AFR (NA)</label>
                </div>

            </div>

            <div id="track_canvas">

            </div>
            <div id="sub_canvas">

            </div>


        </div>

        <script>

            /* global variable for drawing ling graph */

            var margin = {top: 20, right: 20, bottom: 20, left: 70},
                width = document.getElementById("canvas").offsetWidth - margin.left - margin.right,
                height = document.getElementById("canvas").offsetHeight/5 - margin.bottom - margin.top;

            var track_margin = {top: 20, right: 20, bottom: 20, left: 20},
                track_width = document.getElementById("track_canvas").offsetWidth - track_margin.left - track_margin.right,
                track_height = document.getElementById("track_canvas").offsetHeight - track_margin.bottom - track_margin.top;

            var sub_margin = {top: 20, right: 20, bottom: 20, left: 20},
                sub_width = document.getElementById("sub_canvas").offsetWidth - track_margin.left - track_margin.right,
                sub_height = document.getElementById("sub_canvas").offsetHeight - track_margin.bottom - track_margin.top;


            var x = d3.scaleLinear().range([0, width]);
            var y = d3.local();
            var line = d3.local();
            var bisect = d3.bisector(function (d) { return d.x; }).left,
                formatValue = d3.format(",.2f"),
                formatCurrency = function(d) { return formatValue(d);}



            var xAxis = d3.axisBottom(x);
            var svg, track_svg, sub_svg;

            var all_features;
            var selected_features = [];
            var selected_feat_names = [];

            var track_data = [];
            var track_x, track_y;

            var track_line = d3.line().curve(d3.curveBasis)
                .x(function(d) { return track_x(d.long); })
                .y(function(d) { return track_y(d.lat); });


            // sub global data
            var steer_data =[];
//                brake_data = [],
//                gas_data = [],
//                gear_data = [];



            /* draw line chart */

            drawLineChart();

            function drawLineChart(){

                d3.csv("./data/2nd_std_file.csv", type, function(error, data) {
                    if (error) throw error;

                    all_features = data.columns.slice(1).map(function(id) {

                        return {
                            id: id,
                            values: data.map(function(d) {
                                return {x: d.x, feature_val: parseFloat(d[id])};    // float로 parsing 해주어야함.
                            })
                        };
                    });

                    // filter the specific features ( 기본값은 GPS_Speed / RPM ) & push Lat Long for track line
                    selected_features = [];
//                    steer_data = [];
                    var temp_lat = [];
                    var temp_long = [];
                    var temp_steer = [];

                    all_features.forEach(function(d){

                        // 각 칼럼의 첫번째 raw 값을 check, nan일 경우 set check box as unavailable
                        if(isNaN(d.values[0].feature_val)){
                            $("input[type=checkbox]").filter(function() { return this.value == d.id }).attr("disabled", true);
                        }

                        // default feature로 GPS_Speed, RPM 을 plotting.
                        if(d.id == "GPS_Speed (kmh)" || d.id == "RPM (NA)"){
                            selected_features.push(d)
                            selected_feat_names.push(d.id);
                        }else if(d.id == "PosLat (deg)"){
                            temp_lat = _.pluck(d.values, 'feature_val');
                        }else if(d.id == "PosLon (deg)"){
                            temp_long = _.pluck(d.values, 'feature_val');
                        }else if(d.id == "Steer_angle (deg)"){
                            steer_data = _.pluck(d.values, 'feature_val')
                        }else if(d.id == "Pedal_brake (percent)"){
                            brake_data = _.pluck(d.values, 'feature_val')
                        }else if(d.id == "Gear (NA)"){
                            gear_data = _.pluck(d.values, 'feature_val')
                        }


                    });
                    /// ***** assign temp lat long data to global variable *****
                    temp_lat.forEach(function(value, index){
                        track_data.push({
                            long: temp_long[index],
                            lat: value
                        });

                    });

                    /*************************** DRAWING CHART ******************************/

                    // x domain은 TimeStamp 또는 Distance로 ... default로는 TimeStamp
                    x.domain(d3.extent(data, function(d) { return d.x; }));

                    svg = d3.select("#canvas").selectAll("svg")
                        .data(selected_features)
                        .enter().append("svg")
                        .attr("width", width + margin.left + margin.right)
                        .attr("height", height + margin.bottom + margin.top)
                        .append("g")
                        .attr("id", function (d) {
                            return d.id.split(" ")[0];
                            // return d.id.replace(/\s/g, ''); // regx, remove space for setting id
                        })
                        .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                        .each(function (d) {

                            var ty = y.set(this, d3.scaleLinear()
                                .range([height, 0]))
                                // local feature에 대한 y range setting
                                .domain([
                                    d3.min(d.values, function(c) { return c.feature_val; }),
                                    d3.max(d.values, function(c) { return c.feature_val; }) ]);
                            // Global feature에 대한 y range setting
                            //                            .domain([
                            //                                d3.min(features, function(c) { return d3.min(c.values, function(d) { return d.feature_val; }); }),
                            //                                d3.max(features, function(c) { return d3.max(c.values, function(d) { return d.feature_val; }); }) ])

                            // local feature range (0~ max(y))
//                            .domain([ 0, d3.max(d.values, function(c) { return c.feature_val;}) ]);

                            line.set(this, d3.line().curve(d3.curveBasis)
                                .x(function(d){ return x(d.x);})
                                .y(function(d){ return ty(d.feature_val); }));

                        });


                    svg.append("path")
                        .attr("class", "line")
                        .attr("d", function(d) { return line.get(this)(d.values); });


                    svg.append("text")
                    //                    .attr("x", width - 6)
                        .attr("y", height - 50)
                        .attr("x", 10)
                        //                    .attr("y", 10)
                        .text(function(d) { return d.id; });

                    // define y axis
                    for (var i=0; i<selected_features.length; i++){
                        var id = "g#" + selected_features[i].id.split(" ")[0];

                        var y_range = d3.scaleLinear()
                            .range([height, 0])
                            //                        .domain([0, d3.max(selected_features[i].values, function (c) { return c.feature_val }) ]);
                            .domain([
                                d3.min(selected_features[i].values, function(c) { return c.feature_val; }),
                                d3.max(selected_features[i].values, function (c) { return c.feature_val })
                            ]);

                        d3.select(id).append("g")
                            .call(d3.axisLeft(y_range))
//                        .attr("transform", "translate(" + margin.left + "," + 0 + ")")

                        // 마지막 인덱스인 그래프에만 x axis
                        if( i == selected_features.length -1){
                            d3.select(id).append("g")
                                .call(xAxis)
                                .attr("id", "x-axis")
                                .attr("transform", "translate(" + 0 + "," + height + ")");
                        }
                    }

                    var focus = svg.append("g")
                        .attr("class", "focus")
                        .style("display", "none");

                    focus.append("circle")
                        .attr("r", 4.5);
                    focus.append("text")
                        .attr("x", 9)
                        .attr("dy", ".35em")
                        .text("nothing");

                    svg.append("rect")
                        .attr("class", "overlay")
                        .attr("width", width)
                        .attr("height", height)
                        .attr("fill", "transparent")
                        .on("mouseover", function() { focus.style("display", null); })
                        .on("mouseout", function() { focus.style("display", "none"); })
                        .on("mousemove", mousemove);
//

                    // gloabl x-axis 달기
//                svg.append("g")
//                    .call(xAxis)
//                    .attr("transform", "translate(" + 0 + "," + height + ")");




                    /*************************** DRAWING TRACK ******************************/

                    // range of track x, y (Longitude, Latitude) setting
                    track_x = d3.scaleLinear().range([0, track_width])
                        .domain([
                            d3.min(track_data, function(d) { return d.long;}),
                            d3.max(track_data, function(d) {return d.long;})
                        ]);
                    track_y = d3.scaleLinear().range([track_height, 0])
                        .domain([
                            d3.min(track_data, function(d) {return d.lat;}),
                            d3.max(track_data, function(d) {return d.lat;})
                        ]);

                    // setting svg for drawing track
                    track_svg = d3.select("#track_canvas").append("svg")
                        .attr("width", track_width + track_margin.left + track_margin.right)
                        .attr("height", track_height + track_margin.top + track_margin.bottom)
                        .append("g")
                        .attr("transform",
                            "translate(" + track_margin.left + "," + track_margin.top + ")");

                    // append path (drawing track)
                    track_svg.append("path")
                        .data([track_data])
                        .attr("class", "line")
                        .attr("d", track_line)

                    var track_focus = track_svg.append("g")
                        .attr("id", "track_focus1");

                    track_focus.append("circle")
                        .attr("r", 4.5);


                    /******************** Drawing Sub Info ****************************/

                    // setting svg for drawing track
                    sub_svg = d3.select("#sub_canvas").append("svg")
                        .attr("width", sub_width + sub_margin.left + sub_margin.right)
                        .attr("height", sub_height + sub_margin.top + sub_margin.bottom)
                        .append("g")
                        .attr("transform",
                            "translate(" + sub_margin.left + "," + sub_margin.top + ")");

                    // steering

                    var steering_focus = sub_svg.append("g")
                        .attr("id", "steer_focus1")

                    steering_focus.append("image")
                        .attr("xlink:href", "./img/steer.PNG")
                        .attr("transform", "translate(0, 25)");
                    steering_focus.append("text")
                        .text("Steering degree: ");


                    // Brake
                    var brake_focus = sub_svg.append("g")
                        .attr("id", "brake_focus1")
                        .attr("transform", "translate(120, 0)");

                    brake_focus.append("rect")
                        .attr("x", -25)
                        .attr("y", -110)
                        .attr("transform", "rotate(180)")
                        .attr("width", 20)
                        .attr("height", 1)
                        .style("fill", "steelblue");

                    brake_focus.append("text")
                        .text("Brake: ");


                    // Gas
                    var gas_focus = sub_svg.append("g")
                        .attr("id", "gas_focus1")
                        .attr("transform", "translate(240, 0)");
                    gas_focus.append("text")
                        .text("Gas: ");

                    // Gear
                    var gear_focus = sub_svg.append("g")
                        .attr("id", "gear_focus1")
                        .attr("transform", "translate(360, 0)");
                    gear_focus.append("text")
                        .text("Gear: ");




                });

            }


            function mousemove(){

                var x_value = x.invert(d3.mouse(this)[0]);
                var index = 0;

                var focuses = d3.select("#canvas").selectAll("svg")
                    .selectAll(".focus");

                // set all focus elements' style to display
                focuses.style("display", null);

                focuses.attr("transform", function(d){
//                    console.log(d);
                    index = bisect(d.values, x_value, 0, d.values.length -1);

                    var y_range = d3.scaleLinear()
                        .range([height, 0])
                        .domain([
                            d3.min(d.values, function(c) { return c.feature_val; }),
                            d3.max(d.values, function (c) { return c.feature_val })
                        ]);

                    return "translate(" + x(d.values[index].x) + "," + y_range(d.values[index].feature_val) + ")";

                });

                focuses.selectAll("text")
                    .text( function (d) { return + d.values[index].feature_val; });



                // moving Track
                var track_focus = d3.select("#track_focus1");
                track_focus.attr("transform", "translate(" + track_x(track_data[index].long) + "," + track_y(track_data[index].lat) + ")");

                // handle Steering, Brake, Gas, Gear

                // rotate by steering value
                var steer_focus = d3.select("#steer_focus1");
                // 수정필요
                steer_focus.select("image")
                    .attr("transform", "translate(0, 25), rotate(" + steer_data[index] + ", 35, 35)");
                steer_focus.select("text")
                    .text("Steering degree: " + steer_data[index]);

                var brake_focus = d3.select("#brake_focus1");
                brake_focus.select("rect")
                    .attr("height", 1+ brake_data[index]);
                brake_focus.select("text")
                    .text("Brake: " + brake_data[index]);

                var gear_focus = d3.select("#gear_focus1");
                gear_focus.select("text")
                    .text("Gear: " + gear_data[index]);





                // this is for get array data by id
                // console.log(_.where(all_features), function(item) { console.log(item); return item.id=="Steer_angle (deg)"});


            }



            function removeChart(id, index) {

                var target_id = "g#" + id.split(" ")[0];

                d3.select(target_id)
                    .select(function() { return this.parentNode; })
                    .remove();

                // 만약 제거하려는 차트가 마지막 svg일 경우 차트 없앤 뒤에 새로운 x axis생성
                if(index == selected_features.length-1){
                    d3.select("g#" + selected_features[index-1].id.split(" ")[0])
                        .append("g")
                        .call(xAxis)
                        .attr("id", "x-axis")
                        .attr("transform", "translate(" + 0 + "," + height + ")");
                }

            }


            function addChart_old_ver(id) {

                // 이전 x-axis 삭제
                d3.select("#x-axis")
                    .remove();

                // extract target data which is stored in last index of selected_features
                var target_data = selected_features[selected_features.length-1];
//                console.log(target_data);

                ///////////////// update Chart /////////////////// => d3.document 참고해서 수정할것..
                var update_svg = d3.select("#canvas").append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.bottom + margin.top)
                    .append("g")
                    .attr("id", id.split(" ")[0] )
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

                var y_range = d3.scaleLinear()
                    .range([height, 0])
                    .domain([
                        d3.min(target_data.values, function(d) { return d.feature_val; }),
                        d3.max(target_data.values, function(d) { return d.feature_val; })
                    ]);

                var drawline = d3.line()
                    .curve(d3.curveBasis)
                    .x( function(d) { return x(d.x); })
                    .y( function(d) { return y_range(d.feature_val); });


                svg.append("path")
                    .attr("class", "line")
                    .attr("d", drawline(target_data.values) );

                svg.append("text")
                    .attr("y", height - 50)
                    .attr("x", 10)
                    .text(id);

                svg.append("g")
                    .call(d3.axisLeft(y_range));

                // x axis
                svg.append("g")
                    .call(xAxis)
                    .attr("id", "x-axis")
                    .attr("transform", "translate(" + 0 + "," + height + ")");
//                    .attr("transform", "translate(" + 0 + "," + (height +margin.bottom)+ ")");


                var focus = svg.append("g")
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("circle")
                    .attr("r", 4.5);
                focus.append("text")
                    .attr("x", 9)
                    .attr("dy", ".35em")
                    .text("nothing");

                svg.append("rect")
                    .attr("class", "overlay")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("fill", "transparent")
                    .on("mouseover", function() { focus.style("display", null); })
                    .on("mouseout", function() { focus.style("display", "none"); })
                    .on("mousemove", mousemove);


            }



            function addChart(id) {

                // 이전 x-axis 삭제
                d3.select("#x-axis")
                    .remove();

                // extract target data which is stored in last index of selected_features
                var target_data = selected_features[selected_features.length-1];
//                console.log(target_data);

                ///////////////// update Chart /////////////////// => d3.document 참고해서 수정할것..
                console.log(target_data);
                svg = d3.select("#canvas").selectAll("svg").data(selected_features).enter()
//                var update_svg = d3.select("#canvas").selectAll("svg").data(selected_features).enter()
                    .append("svg")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.bottom + margin.top)
                    .append("g")
                    .attr("id", function (d) {
                        return d.id.split(" ")[0];
                        // return d.id.replace(/\s/g, ''); // regx, remove space for setting id
                    })
                    .attr("transform", "translate(" + margin.left + "," + margin.top + ")")
                    .each(function (d) {

                        var ty = y.set(this, d3.scaleLinear()
                            .range([height, 0]))
                        // local feature에 대한 y range setting
                            .domain([
                                d3.min(d.values, function(c) { return c.feature_val; }),
                                d3.max(d.values, function(c) { return c.feature_val; }) ]);

                        line.set(this, d3.line().curve(d3.curveBasis)
                            .x(function(d){ return x(d.x);})
                            .y(function(d){ return ty(d.feature_val); }));

                    });


                svg.append("path")
                    .attr("class", "line")
                    .attr("d", function(d) { return line.get(this)(d.values); });


                svg.append("text")
                    .attr("y", height - 50)
                    .attr("x", 10)
                    .text(function(d) { return d.id; });

                var y_range = d3.scaleLinear()
                    .range([height, 0])
                    .domain([
                        d3.min(target_data.values, function(d) { return d.feature_val; }),
                        d3.max(target_data.values, function(d) { return d.feature_val; })
                    ]);

                svg.append("text")
                    .attr("y", height - 50)
                    .attr("x", 10)
                    .text(id);

                svg.append("g")
                    .call(d3.axisLeft(y_range));


                // x axis
                svg.append("g")
                    .call(xAxis)
                    .attr("id", "x-axis")
                    .attr("transform", "translate(" + 0 + "," + height + ")");
//                    .attr("transform", "translate(" + 0 + "," + (height +margin.bottom)+ ")");


                var focus = svg.append("g")
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("circle")
                    .attr("r", 4.5);
                focus.append("text")
                    .attr("x", 9)
                    .attr("dy", ".35em")
                    .text("nothing");

                svg.append("rect")
                    .attr("class", "overlay")
                    .attr("width", width)
                    .attr("height", height)
                    .attr("fill", "transparent")

                d3.select("#canvas").selectAll(".overlay")
                    .on("mouseover", function() { focus.style("display", null); })
                    .on("mouseout", function() { focus.style("display", "none"); })
                    .on("mousemove", mousemove);


            }


            function updateChart(value, checked){
                ///////////////// update data ///////////////////////

                // chart 업데이트 by the checked value of check-box (_.pluck => dictionary array의 특정 value만을 array로 return.)
                var feat_names = _.pluck(selected_features, 'id'); // current feat_names

                // if checked is true
                if(checked){
                    // if the value is NOT contained in array, then add to the array
                    if(! (_.contains(feat_names, value)) ){

                        // selected features array update
                        all_features.forEach(function (d) {
                            if(d.id == value){
                                selected_features.push(d);
                            }
                        });
                        // add target chart (해당 value값을 가진 chart 추가)
                        addChart(value);

                    }

                // if checked is false
                }else{
                    // if the value is contained in array, then remove from the array
                    if(_.contains(feat_names, value)){
                        var index = _.indexOf(feat_names, value);
                        console.log(value, index);
                        // remove target chart (해당 value값을 가진 chart 삭제)
                        removeChart(value, index);
                        selected_features.splice(index, 1);
                    }
                }

            }

            function brushed() {
                if (d3.event.sourceEvent && d3.event.sourceEvent.type === "zoom") return; // ignore brush-by-zoom
                var s = d3.event.selection || x2.range();
                x.domain(s.map(x2.invert, x2));
                focus.select(".area").attr("d", area);
                focus.select(".axis--x").call(xAxis);
                svg.select(".zoom").call(zoom.transform, d3.zoomIdentity
                    .scale(width / (s[1] - s[0]))
                    .translate(-s[0], 0));
            }

            function zoomed() {
                if (d3.event.sourceEvent && d3.event.sourceEvent.type === "brush") return; // ignore zoom-by-brush
                var t = d3.event.transform;
                x.domain(t.rescaleX(x2).domain());
                focus.select(".area").attr("d", area);
                focus.select(".axis--x").call(xAxis);
                context.select(".brush").call(brush.move, x.range().map(t.invertX, t));
            }



            // checkbox click listener
            function handleCBclick(cb){
                // check박스가 하나라도 클릭되었을 경우 check 되어진 값들 가져온 뒤 chart update
//                console.log(cb.checked);
//                console.log(cb.value);

                var checked_values = []
                $("input[type=checkbox]:checked").each(function () {
//                    console.log($(this).val())
                    checked_values.push($(this).val())
                });

                if(checked_values.length == 15){
                    // 4개 이상 일때 클릭할 경우 check value 원상태로..
                    $("input[value='" + cb.value +"']").prop("checked", false);
                    return;
                }

                updateChart(cb.value, cb.checked);
            }


            // This function supports parsing the column from input data.
            function type(d, _, columns) {

                d.x = d["TimeStamp (sec)"]

                for (var i = 1, n = columns.length, c; i < n; ++i) {
                    d[c = columns[i]]  =  +d[c];
                    return d;
                }
            }

        </script>




    </div>

    <!-- Modals -->
    <div id="aboutModal" class="modal">
        <!-- about Modal content -->
        <div class="modal-content">
            <div class="modal-header">
                <span class="close">&times;</span>
                <h3>About</h3>
            </div>
            <div class="modal-body">
                <section>
                    <h4>PolView</h4>
                    <p>This work represent trends of political views by birth year in South Korea.</p>
                    <br>

                </section>

                <section>
                    <h4>Data Source</h4>
                    <p> KGSS (Korean General Social Survey) from 2003 to 2016. KGSS was not conducted in 2015
                    </p>
                    <br>


                </section>

                <section>
                    <h4>Development</h4>
                    <p>Powered by d3.js</p>
                    <br>

                </section>

            </div>
            <div class="modal-footer">
                <!--<h5>Modal Footer</h5>-->
                <p>Developed and Designed by Heungseok Park. </p>
                <p>&copy; 2017 All rights reserved. </p>
            </div>
        </div>

    </div>


    <script>

        // get the modal
        var modal = document.getElementById("aboutModal");

        // get the button that opens the modal
        var btn = document.getElementById("about");

        // get the <span> element that cloases the modal;
        var span = document.getElementsByClassName("close")[0];

        // When the user clicks the button, open the modal
        btn.onclick = function () {
            modal.style.display = "block";
        }

        // When the user clicks on <span> (x), close the modal
        span.onclick = function () {
            modal.style.display = "none";
        }

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function (event) {
            if(event.target == modal){
                modal.style.display = "none";
            }
        }


        function closeNavLeft() {
            document.getElementById("sideNavLeft").style.width = "0";

        }

        function closeNavRight() {
            document.getElementById("sideNavRight").style.width = "0";

        }


    </script>


</body>
</html>